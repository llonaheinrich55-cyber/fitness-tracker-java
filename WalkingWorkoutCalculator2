package fitrak3.ui.basic;

import fitrak3.basic.WalkingWorkout;
import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

public class WalkingWorkoutCalculator extends JFrame {
    private JPanel MainPanel;
    private JPanel Jpanel2;
    private JLabel TitleLabel;
    private JTextField durationMinutes;
    private JLabel durationLabel;
    private JTextField date;
    private JLabel dateLabel;
    private JTextField weight;
    private JLabel weightLabel;
    private JTextField steps;
    private JLabel stepsLabel;
    private JComboBox<String> intensityComboB;
    private JLabel intensityLabel;
    private JComboBox<String> sexComboB;
    private JLabel sexLabel;
    private JTextField height;
    private JLabel heightLabel;
    private JLabel Output;
    private JButton OutputButton;
    private JLabel errorLabel;
    private JLabel titleLabel;

    public WalkingWorkoutCalculator() {
        setContentPane(MainPanel);

        // Set modern look and feel
        try {
            for (UIManager.LookAndFeelInfo info : UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    UIManager.setLookAndFeel(info.getClassName());
                    SwingUtilities.updateComponentTreeUI(this);
                    break;
                }
            }
        } catch (Exception ignored) {}

        // Set up fonts for better visibility
        Font labelFont = new Font("Arial", Font.PLAIN, 14);
        Font titleFont = new Font("Arial", Font.BOLD, 20);
        Font buttonFont = new Font("Arial", Font.BOLD, 14);

        // Apply fonts to all components
        if (titleLabel != null) titleLabel.setFont(titleFont);

        durationLabel.setFont(labelFont);
        durationLabel.setText("Duration (minutes):");
        durationMinutes.setFont(labelFont);

        dateLabel.setFont(labelFont);
        dateLabel.setText("Date (YYYY-MM-DD):");
        date.setFont(labelFont);

        weightLabel.setFont(labelFont);
        weightLabel.setText("Weight (kg):");
        weight.setFont(labelFont);

        stepsLabel.setFont(labelFont);
        stepsLabel.setText("Steps:");
        steps.setFont(labelFont);

        intensityLabel.setFont(labelFont);
        intensityLabel.setText("Intensity:");
        intensityComboB.setFont(labelFont);
        intensityComboB.setModel(new DefaultComboBoxModel<>(new String[]{"Calm", "Brisk"}));

        sexLabel.setFont(labelFont);
        sexLabel.setText("Sex:");
        sexComboB.setFont(labelFont);
        sexComboB.setModel(new DefaultComboBoxModel<>(new String[]{"Male", "Female"}));

        heightLabel.setFont(labelFont);
        heightLabel.setText("Height (cm):");
        height.setFont(labelFont);

        OutputButton.setFont(buttonFont);
        OutputButton.setText("Calculate");

        Output.setFont(labelFont);

        if (errorLabel != null) {
            errorLabel.setFont(labelFont);
            errorLabel.setForeground(Color.RED);
            errorLabel.setText("");
        }

        setVisible(true);
        setSize(550, 650);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setTitle("Walking Workout Calculator");
        setLocationRelativeTo(null);

        OutputButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                if (errorLabel != null) errorLabel.setText("");
                Output.setText("");

                try {
                    double duration = Double.parseDouble(durationMinutes.getText().trim());
                    String dateStr = date.getText().trim();
                    double userWeight = Double.parseDouble(weight.getText().trim());
                    int userSteps = Integer.parseInt(steps.getText().trim());
                    String userIntensity = (String) intensityComboB.getSelectedItem();
                    String userSex = (String) sexComboB.getSelectedItem();
                    double userHeight = Double.parseDouble(height.getText().trim());

                    if (duration <= 0) {
                        showError("Duration must be greater than 0!");
                        return;
                    }
                    if (userWeight <= 0 || userWeight > 500) {
                        showError("Weight must be between 1-500 kg!");
                        return;
                    }
                    if (userHeight <= 0 || userHeight > 300) {
                        showError("Height must be between 1-300 cm!");
                        return;
                    }
                    if (userSteps < 0) {
                        showError("Steps cannot be negative!");
                        return;
                    }
                    if (dateStr.isEmpty()) {
                        showError("Please enter a date!");
                        return;
                    }

                    WalkingWorkout walk = new WalkingWorkout(
                            duration, userWeight, dateStr, userSteps, userIntensity, userSex, userHeight
                    );

                    String result = String.format(
                            "<html>" +
                                    "<b>Workout Results:</b><br><br>" +
                                    "Date: %s<br>" +
                                    "Duration: %.1f minutes<br>" +
                                    "Steps: %d<br>" +
                                    "Distance: %.2f km<br>" +
                                    "Calories Burned: %.2f kcal" +
                                    "</html>",
                            walk.getDate(),
                            walk.getDurationMinutes(),
                            walk.getSteps(),
                            walk.getDistanceKM(),
                            walk.getCaloriesBurned()
                    );
                    Output.setText(result);
                    Output.setForeground(new Color(0, 100, 0));

                } catch (NumberFormatException ex) {
                    showError("Please enter valid numbers!");
                } catch (Exception ex) {
                    showError("Error: " + ex.getMessage());
                }
            }
        });
    }

    private void showError(String message) {
        if (errorLabel != null) {
            errorLabel.setText(message);
            errorLabel.setForeground(Color.RED);
        } else {
            JOptionPane.showMessageDialog(this, message, "Input Error", JOptionPane.ERROR_MESSAGE);
        }
        Output.setText("");
    }

    private void createUIComponents() {
        // TODO: place custom component creation code here
    }
}
